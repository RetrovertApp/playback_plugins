--- a/src/pmdwin/compat.h
+++ b/src/pmdwin/compat.h
@@ -9,7 +9,11 @@
 typedef long long _int64;
 
 #ifndef HAVE_STRNICMP
-# define strnicmp strncasecmp
+# ifdef _WIN32
+#  define strnicmp _strnicmp
+# else
+#  define strnicmp strncasecmp
+# endif
 #endif
 
 #ifndef HAVE__ISMBBLEAD
@@ -55,12 +59,14 @@
 # define PATH_DELIMIT_STR "/"
 #endif
 
-#ifndef WIN32
-# define __declspec(x)
-# define WINAPI
+#ifndef __declspec
+#define __declspec(x)
+#endif
+#ifndef WINAPI
+#define WINAPI
 #endif
 
-#ifdef __GNUC__
+#if defined(__GNUC__) || defined(__clang__)
 # define __PACKED__ __attribute__((packed))
 #endif
 
