///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// xSF 2SF Wrapper - Nintendo DS emulation via vio2sf
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#pragma once

#include <stddef.h>
#include <stdint.h>

#ifdef __cplusplus
extern "C" {
#endif

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Opaque state handle

typedef struct Xsf2sfState Xsf2sfState;

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Create a new 2SF emulator state

void* xsf_2sf_create(void);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// psflib load callback - accumulates ROM and save state data from PSF container chain.
// Called once per file in the library chain (deepest first).

int xsf_2sf_load(void* context, const uint8_t* exe, size_t exe_size, const uint8_t* reserved, size_t reserved_size);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Pre-load initialization (minimal - just records version)

int xsf_2sf_start(void* state, int psf_version);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Post-load finalization - initializes NDS emulator with accumulated ROM/state data.
// Must be called after all psf_load callbacks complete.

int xsf_2sf_post_load(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Render audio frames. Output is stereo S16 interleaved at 44100 Hz.
// Returns number of frames actually rendered.

int xsf_2sf_render(void* state, int16_t* buffer, int frames);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Get the native sample rate (44100 Hz)

int xsf_2sf_sample_rate(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Reset for seek-to-start. Frees accumulated data so psf_load can re-accumulate.

int xsf_2sf_seek_reset(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Destroy the 2SF emulator state

void xsf_2sf_destroy(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Info callback for 2SF-specific tags (initial_frames, sync_type, clockdown, etc.)

int xsf_2sf_info(void* state, const char* name, const char* value);

#ifdef __cplusplus
}
#endif
