///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// xSF PSF/PSF2 Wrapper - PlayStation 1/2 emulation via highly_experimental
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#pragma once

#include <stddef.h>
#include <stdint.h>

#ifdef __cplusplus
extern "C" {
#endif

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Opaque state handle

typedef struct XsfPsfState XsfPsfState;

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// One-time BIOS + psx_init() setup. Must be called before any PSF playback.
// bios_data must remain valid for the lifetime of the program.
// Returns 0 on success, -1 on failure.

int xsf_psf_init_bios(const uint8_t* bios_data, uint32_t bios_size);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Create a new PSF emulator state

void* xsf_psf_create(void);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// psflib load callback - called once per file in the library chain (deepest first).
// version: 1 for PSF, 2 for PSF2

int xsf_psf_load(void* context, const uint8_t* exe, size_t exe_size, const uint8_t* reserved, size_t reserved_size);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// psflib info callback for PSF2 psf2fs filesystem loading

int xsf_psf2_load(void* context, const uint8_t* exe, size_t exe_size, const uint8_t* reserved, size_t reserved_size);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Render audio frames. Output is stereo S16 interleaved.
// Returns number of frames actually rendered.

int xsf_psf_render(void* state, int16_t* buffer, int frames);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Get the native sample rate for the current PSF type

int xsf_psf_sample_rate(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Prepare for playback after loading. Call after all psf_load callbacks complete.
// psf_version: 1 for PSF, 2 for PSF2

int xsf_psf_start(void* state, int psf_version);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Reset to beginning for seek-to-start

int xsf_psf_seek_reset(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Destroy the PSF emulator state

void xsf_psf_destroy(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Get the psf2fs handle for PSF2 loading (needed by psflib's psf2fs_load_callback)

void* xsf_psf_get_psf2fs(void* state);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Enable or disable per-channel scope capture

void xsf_psf_enable_scope_capture(void* state, int enable);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Get per-channel scope data from the SPU ring buffers.
// channel: 0-23 for PSF1, 0-47 for PSF2
// Returns number of samples written to buffer.

uint32_t xsf_psf_get_scope_data(void* state, int channel, float* buffer, uint32_t num_samples);

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Get number of scope channels (24 for PSF1, 48 for PSF2)

int xsf_psf_get_scope_channel_count(void* state);

#ifdef __cplusplus
}
#endif
